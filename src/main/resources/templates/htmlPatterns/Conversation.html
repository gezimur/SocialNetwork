<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>JugglersSocialNetwork</title>
    <link rel="stylesheet" type="text/css" href="../css/maincss.css">
</head>
<body class="body">
<span class="blockWithLinks">
		<a href="/authorization">my profile</a><br>
		<a href="/conversations">conversations</a><br>
		<a href="/search">search</a><br>
		<a href="/help">help</a><br>
		<a href="/singOut">sing out</a><br>
	</span>
<p class="mainBlock">
		<span>
            <span class="name">Conversation</span>
		</span>
    <span class="bigBlock">
		<input id="textLine" type="text">
		<button onclick="sendMessage()">send message</button>
		<br>
		<span id="textSpace">
		</span>
	</span>
</p>
<script>
	function sendMessage(){
		var message = createMessage();
		var form = createMyForm(message);
		var response = sendForm(form);
		updateTextSpace(response);
	}
	function updateTextSpace(response){
		var span = document.createElement('span');
		span.className = "message";
		span.innerHTML = response + "<br>";
		var textSpace = document.getElementById("textSpace");
		textSpace.prepend(span);
	}
	function sendForm(form){
		var req = new XMLHttpRequest();
		var url = '/sendMessage';
		var response = "some problems";
		req.open('POST', url);
		req.setRequestHeader('Content-Type', 'application/x-www-form-url');
		req.addEventListener('load', function(e){
			var data = e.target;
			response = data.response;
		});
		req.send(form);
		return response;//only now============================
	}
	function createMyForm(message){
		var form = new FormData();
		form.append("message", message);
		return form;
	}
	function createMessage() {
		var textLine = document.getElementById("textLine");
		var message = textLine.value;
		textLine.value = "";
		return message;
	}
</script>
</body>
</html>